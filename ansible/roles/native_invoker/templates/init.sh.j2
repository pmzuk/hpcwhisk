#!/bin/bash
set -e

{% for module in invoker.slurmModules %}
module add {{ module }}
{% endfor %}

cd $(dirname $0)
source ../conf/environment.sh

if [ -n "${CONTROLLER_SETUP}" ]; then
  source ${CONTROLLER_SETUP}
fi

export INVOKER_OPTS="$INVOKER_OPTS $(./transformEnvironment.sh)"
exec ./invoker --id $SLURM_ARRAY_TASK_ID --uniqueName $SLURM_ARRAY_TASK_ID
